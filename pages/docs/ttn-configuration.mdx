---
layout: 'docs'
title: 'Applikation auf TTN konfigurieren'
metaTitle: 'Konfiguration auf TTN'
metaDescription: 'Konfiguration der Applikationen auf TTN'
---
  
<p className="lead">
  Oder auch: wie Du TTN mit Stadtpuls reden lässt.
</p>

Die nachfolgende Dokumentation basiert auf der neuen The Things Stack Community Edition, auch TTN V3 genannt. Stadtpuls funktioniert zwar auch mit dem alten TTN Stack (V2), unterstützt aber in der Doku und der weiteren Entwicklung ausschließlich TTN V3.

## TTN-Webhook in drei Minuten einrichten
Die Webhook-Integration zu konfigurieren ist kein Hexenwerk und schnell erledigt. Man muss nur wissen, wo und wie es geht. First things first:
1. Logge Dich auf <a href="https://www.thethingsnetwork.org/" target="_blank">https://www.thethingsnetwork.org/</a> in Deinen TTN-Account ein. Wichtig:
2. Navigiere zu Deiner TTN-Applikation, die Du mit Stadtpuls verknüpfen möchtest.
3. In der linken Seitenleiste siehst Du einen Menüpunkt namens **Integrations**. Klicke darauf, um das Dropdown-Menü zu öffnen und klicke anschließend auf **Webhooks**

Dort angekommen, kannst Du einen neuen TTN-Webook für Deine TTN-Applikation einrichten. Klicke dazu auf **Add Webhook** und wähle **Custom Webhook** aus. 

### Webhook Parameter

Die **Webhook ID**, respektive der Name Deines Webhooks, ist frei wählbar und ganz Dir überlassen.

Das **Webhook format** ist JSON.

&#x1f4a1; Was beim TTN V3 Stack der Webhook ist, war beim TTN V2 Stack die HTTP-Integration. Die Funktionweise ist die gleiche: sowohl die HTTP-Integration als auch der Webhook können *POST* und *GET* Operationen über HTTP an einem bestimmten Endpoint ausführen.

Unter den Endpoint Setting muss nun der API-Endpoint konfiguriert werden. In unserem Falle nutzen wir als **Base URL** des Endpoints die RESTful API von Stadtpuls: 
```shell
https://api.stadtpuls.com/
```
Wir übergeben der API jedoch noch eine zusätzliche Information – **Additional headers** mit dem Namen *authorization* im Header: nämlich den Authorizierungs-Token Deines Stadtpuls-Projektes.

   <figure>
  <img style={{maxHeight: 400, border: '1px solid rgba(0, 0, 0, 0.05)'}}
    src="/images/ttnWebhook2.png"
    alt="Konfiguration der TTN-Webhook-Integration"
  />
    <figcaption>
    So sieht die Konfiguration der TTN-Webhook-Integration aus
    </figcaption>
  </figure>

&#x26a0; Nutze als Wert für *authorization* Deinen persönlichen Token aus Stadtpuls.

Wenn Du ein neues Projekt auf Stadtpuls erstellst, wird für Deine Projekt automatisch ein neuer Token generiert. Kopiere diesen mit dem Zusatz `Bearer ` in das Eingabefeld. Solltest Du Deinen Token verloren haben, kannst Du Dir in Deiner Projektansicht einen neuen Token generieren lassen. Der alte Token verliert damit automatisch seine Gültigkeit und kann nicht mehr für die Authentifizierung Deines Projekts bzw. Deiner Sensoren genutzt werden.

Schließlich müssen wir dem Webhook noch mitteilen, bei welcher Art von Events er getriggert werden soll. In unserem Fall möchten wir bei jedem Uplink, also bei jedem Datenpaket, welches in der TTN-Applikation ankommt, einen POST-Request auf unsere Stadtpuls-API ausführen. Der Endpoint dafür lautet
```shell
/api/v2/integrations/ttn/v3
```
   <figure>
  <img style={{maxHeight: 400, border: '1px solid rgba(0, 0, 0, 0.05)'}}
    src="/images/ttnMessages.png"
    alt="Konfiguration der TTN-Webhook-Integration"
  />
    <figcaption>
    Webhook wird bei Uplinks der Sensoren getriggert
    </figcaption>
  </figure>

Hurray! Du hast TTN erfolgreich mit Stadtpuls verknüpft.
